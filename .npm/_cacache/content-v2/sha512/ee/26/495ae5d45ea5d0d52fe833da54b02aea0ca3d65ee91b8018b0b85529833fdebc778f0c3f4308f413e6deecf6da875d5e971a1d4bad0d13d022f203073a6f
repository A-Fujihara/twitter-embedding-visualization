{"_id":"deepkill","_rev":"4-62c7c9586f18b7fa49d60e11412bc9f9","name":"deepkill","description":"Small helper to kill a process and all its children","dist-tags":{"latest":"0.2.0"},"versions":{"0.1.0":{"name":"deepkill","description":"Small helper to kill a process and all its forks","version":"0.1.0","keywords":[],"author":{"name":"Jason Lenoble","email":"jason.lenoble@gmail.com"},"contributors":[],"license":"MIT","engines":{"node":">=7.3.0"},"main":"lib/deepkill.js","scripts":{"test":"gulp test"},"repository":{"type":"git","url":"git://github.com/jlenoble/deepkill.git"},"bugs":{"url":"https://github.com/jlenoble/deepkill/issues"},"homepage":"https://github.com/jlenoble/deepkill#readme","dependencies":{"ps-tree":"^1.1.0"},"devDependencies":{"autoreload-gulp":"*","babel-plugin-add-module-exports":"*","babel-preset-es2015":"*","babel-preset-es2016":"*","babel-preset-es2017":"*","chai":"*","child-process-data":"^0.5.1","del":"*","eslint-config-google":"*","gulp":"git://github.com/gulpjs/gulp.git#4.0","gulp-babel":"*","gulp-eslint":"*","gulp-mocha":"*","gulp-rename":"*","gulp-replace":"*","gulp-sourcemaps":"*","gulp-wrap":"*","markdown-include":"*","muter":"*","plumb-gulp":"*"},"peerDependencies":{},"gitHead":"800c1f8b3a680c7b55a852f562ff5564978cf449","_id":"deepkill@0.1.0","_shasum":"b5b84c1e55d7edfbea01b590100e7407e6324d75","_from":".","_npmVersion":"3.10.10","_nodeVersion":"7.3.0","_npmUser":{"name":"jlenoble","email":"jason.lenoble@gmail.com"},"dist":{"shasum":"b5b84c1e55d7edfbea01b590100e7407e6324d75","tarball":"https://registry.npmjs.org/deepkill/-/deepkill-0.1.0.tgz","integrity":"sha512-QgwZT8K4ecVOEwy9GNkfROfeTvTeZxzRLG1//1uIyeSPdaPQ+0pmFPfwFPgP/ej0Y2IemkTJZmrInt1DEwhblQ==","signatures":[{"keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA","sig":"MEUCIQDY++eforstXvV8MrhMpMeQVnrOq1ARfwibVgEbc1YPqAIgLgAAf++WwaLx4usTFMvdlXXJLxypUuYCk7Mw70UqRIM="}]},"maintainers":[{"name":"jlenoble","email":"jason.lenoble@gmail.com"}],"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/deepkill-0.1.0.tgz_1495748836551_0.9586837280075997"},"directories":{}},"0.2.0":{"name":"deepkill","version":"0.2.0","description":"Small helper to kill a process and all its children","keywords":["kill","process"],"homepage":"https://github.com/jlenoble/deepkill#readme","main":"lib/deepkill.js","types":"lib/deepkill.d.ts","bugs":{"url":"https://github.com/jlenoble/deepkill/issues"},"scripts":{"test":"gulp test"},"license":"MIT","author":{"name":"Jason Lenoble","email":"jason.lenoble@gmail.com"},"repository":{"type":"git","url":"git+https://github.com/jlenoble/deepkill.git"},"engines":{"node":">=10.9.0"},"dependencies":{"@types/ps-tree":"^1.1.0","ps-tree":"^1.2.0"},"devDependencies":{"@babel/core":"^7.4.5","@babel/plugin-proposal-class-properties":"^7.4.4","@babel/plugin-proposal-decorators":"^7.4.4","@babel/plugin-proposal-object-rest-spread":"^7.4.4","@babel/preset-env":"^7.4.5","@babel/preset-typescript":"^7.3.3","@babel/register":"^7.4.4","@types/chai":"^4.1.7","@types/del":"^4.0.0","@types/ejs":"^2.6.3","@types/eslint":"^4.16.6","@types/eslint-plugin-prettier":"^2.2.0","@types/gulp":"^4.0.6","@types/gulp-babel":"^6.1.29","@types/gulp-cached":"^0.0.31","@types/gulp-mocha":"^0.0.32","@types/gulp-newer":"^0.0.31","@types/gulp-rename":"^0.0.33","@types/gulp-replace":"^0.0.31","@types/gulp-sourcemaps":"^0.0.32","@types/gulp-typescript":"^2.13.0","@types/prettier":"^1.16.4","@types/typescript":"^2.0.0","@typescript-eslint/eslint-plugin":"^1.9.0","@typescript-eslint/parser":"^1.9.0","autoreload-gulp":"^0.4.1","babel-plugin-add-module-exports":"^1.0.2","chai":"^4.2.0","child-process-data":"^0.7.0","del":"^4.1.1","ejs":"^2.6.1","eslint":"^5.16.0","eslint-config-google":"^0.13.0","eslint-config-prettier":"^4.3.0","eslint-plugin-prettier":"^3.1.0","gulp":"^4.0.2","gulp-babel":"^8.0.0","gulp-cached":"^1.1.1","gulp-eslint":"^5.0.0","gulp-mocha":"^6.0.0","gulp-newer":"^1.4.0","gulp-rename":"^1.4.0","gulp-replace":"^1.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^5.0.1","gulp-wrap":"^0.15.0","markdown-include":"^0.4.3","mochawesome":"^3.1.2","plumb-gulp":"^0.2.2","prettier":"^1.17.1","typescript":"^3.4.5"},"peerDependencies":{},"optionalDependencies":{},"gitHead":"f15742382d0478c54e2052ee88f6e2efc0cb5b54","_id":"deepkill@0.2.0","_nodeVersion":"10.9.0","_npmVersion":"6.9.0","dist":{"integrity":"sha512-pAZ1ATM5tScoWHd5/lqXg+ZXA4g2HHk6yCudt2uEOcGwsH7mThiSi0+Pni5pXfvNy3FRNf9C7zsfy1MvaFMuRA==","shasum":"8fb70980c6a4234139e10200ca9ce1fda166f8e3","tarball":"https://registry.npmjs.org/deepkill/-/deepkill-0.2.0.tgz","fileCount":5,"unpackedSize":8550,"npm-signature":"-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJc6YAaCRA9TVsSAnZWagAAnIwP/i+iBcsoGfIvSGZrlaDr\nmPPGUKfsKLA2x3V38hckhkp1GDMsYwbTrZLGUcBAZqo/SyavBFGS7f2OtUoh\nytwJJ69iPRrI6VMG3VFlH4147+AgmvAlCbHXcKr/1uoizExs0Em6kbxuSbor\nQ4oJPcPidHupXXHcBDDw51kQB7J+O78UHO7DXCSLT/cZKcvbQKNW/YfZ2sZS\nLUyMGyugFX91g9DpCpr6ucsjc10ORbVkioGXhJy3mFBxoFiEF2iy5rA0Yeqy\nvlpLlJvq+2DVzrT8Cgzkg+i8LUkb9YpobhJxkzbpWuU0MMIh/8XT+d8FtQrO\nLb/AcQB/orFdmFTNuKXESwPV1X+eVq+b7O310RWYYo51v7EJSHlGrO8P+5Mv\nC0WHNGqEeky7oTjs+RwxyX2X7IJGanVHW+KmBm8WjT+63AervmxdZr0F5/tk\nR8aB1g0S4lhckqBo2JzGZ8jfWFFNbYTOslJIJ4XFjiFK4lpl+X8RGQn0gY7u\nSP6smsLDLI1G5dJUk8vs5nRpe/svWL161r0r7XwmTrD2e0sRaKbxC4bjSxwH\nteGlrIHNIjc7Rz92Zuo6Dkn+fhyQE8G1AeRF8wdA38KBRQQQj6SUJY7WBN5O\nj6m7HaPWGaXrGiOTtMxgUjmaCIv5buKXtyp6ltFAcFCy3v68GjlU79s11ARn\nPj/9\r\n=M9ml\r\n-----END PGP SIGNATURE-----\r\n","signatures":[{"keyid":"SHA256:jl3bwswu80PjjokCgh0o2w5c2U4LhQAE57gj9cz1kzA","sig":"MEQCICM5GW3Mw2VgJ85muyEqMXrYpKyA4PrRIvjvUnk5fMSzAiBKMP9EI8zBZIaRo08n1AafreWtXITGBNyNI7sD+vEuPg=="}]},"maintainers":[{"name":"jlenoble","email":"jason.lenoble@gmail.com"}],"_npmUser":{"name":"jlenoble","email":"jason.lenoble@gmail.com"},"directories":{},"_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/deepkill_0.2.0_1558806552770_0.15890698196218578"},"_hasShrinkwrap":false}},"readme":"# deepkill\n\nSmall helper to kill a process and all its children\n\n  * [Background](#background)\n  * [Usage](#usage)\n  * [License](#license)\n\n\n## Background\n\nSay you're practicing TDD devotely. All your files are watched and `Mocha` does its thing while you keep improving your code.\n\nSay you're working on a library that spawns a subprocess. Now the latter has a bug. Your unit tests fail as expected: You haven't received the right signal, or captured the right message, or whatever.\n\nYou fix, you hope, the bug but nothing happens. Your files are still watched, but `Mocha` doesn't react. Duh?\n\nIs `Mocha` still waiting for your unit tests to complete? Shouldn't it have timed out by now?\n\nThe problem is that the buggy subprocess is hanging, and make the test runner itself hang. The unit tests *are* complete, but *not* the test runner. You kill it by hand, restart it and everything goes back to normal, once! Your watcher will remain unusable as long as your subprocess has bugs.\n\nOf course, your child processes should recover from exceptions, or they should send the right messages and their parents clean up the mess, but that's when everything works and the library is published. For now the watcher process is broken and may remain so for a while.\n\nUsing `deepKill` is a **hack**. You call it after each test that spawns a buggy subprocess that makes your watcher hang and the run will complete as expected, whether the child process returned naturally or not.\n\n## Usage\n\n`deepKill` has the following signature:\n\n`async function deepKill(pid: number, signal: string = \"SIGKILL\"): Promise<void>`\n\nwhere:\n\n* `pid` is the *PID* of the child process you need to kill with all its children.\n* `signal` defaults to `\"SIGKILL\"` and is sent to the child process you need to kill and to all its children.\n\nIn the following example, we kill a child process that prevents our code from completing without relying on its killing properly its own children, that is we use `deepKill(pid)` and not `process.kill(pid)`.\n\n```js\nimport deepKill from \"deepkill\";\nimport { spawn } from \"child_process\";\n\n// We create several child processes that will prevent this very process from ever completing.\nconst   p = spawn(\"node\", [\"./fork1.js\"]);\n\n// Now we do stuff while the children are running...\n\n// By killing the spawned process explicitly with deepKill, we also kill all the processes\n// it has ever created and that have not closed yet, thus allowing this very process to return\ndeepKill(p.pid).then(\n  () => {\n    // We do more cleanup stuff after the children have closed...\n  },\n  () => {\n    // We could not somehow terminate all the child processes.\n    console.warn(`\nSome helpful message telling the user how to:\n  - abort\n  - find and kill the surviving child processes by hand\n  - track and report the exposed bug\n`);\n  }\n);\n```\n\nFirst we spawn `\"fork1.js\"`:\n\n```js\n// File \"./fork1.js\"\nimport { fork } from \"child_process\";\n\n// fork1.js launches fork2.js which launches hang.js. The latter (an infinite loop)\n// won't close, so neither fork2.js nor fork1.js will complete unless killed explicitly.\nfork(\"./fork2.js\");\n```\n\nwhich in turn forks `\"fork2.js\"`:\n\n```js\n// File \"./fork2.js\"\nimport { fork } from \"child_process\";\n\n// fork2.js launches hang.js, which cannot complete by itself, therefore\n// this process cannot complete either\nfork(\"./hang.js\");\n```\n\nwhich forks `\"hang.js\"`, an infinite loop:\n\n```js\n// File \"./hang.js\"\n// hang.js will never complete unless killed explicitly\nwhile (1) {}\n```\n\nNow our code will hang forever, unless we kill it, or kill `\"node hang.js\"`.\n\nIf we kill `\"node fork2.js\"`, then `\"node fork1.js\"` will return, but not `\"node hang.js\"`, nor our code.\n\nUntil we write properly our subprocesses, `deepKill` keeps our development process from hanging.\n\n## License\n\ndeepkill is [MIT licensed](./LICENSE).\n\nÂ© 2017-2019 [Jason Lenoble](mailto:jason.lenoble@gmail.com)\n\n","maintainers":[{"name":"jlenoble","email":"jason.lenoble@gmail.com"}],"time":{"modified":"2022-06-14T23:06:48.968Z","created":"2017-05-25T21:47:17.479Z","0.1.0":"2017-05-25T21:47:17.479Z","0.2.0":"2019-05-25T17:49:12.865Z"},"homepage":"https://github.com/jlenoble/deepkill#readme","keywords":["kill","process"],"repository":{"type":"git","url":"git+https://github.com/jlenoble/deepkill.git"},"author":{"name":"Jason Lenoble","email":"jason.lenoble@gmail.com"},"bugs":{"url":"https://github.com/jlenoble/deepkill/issues"},"license":"MIT","readmeFilename":"README.md"}